## üìä –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Sprint 7 (M7) ‚Äî Key Derivation

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ |
| ---------- | ------ | -------------- |
| **STR-1**  | ‚úÖ     | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è M1‚ÄìM6 —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã |
| **STR-2**  | ‚úÖ     | –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `pycryptocore/kdf/` (pbkdf2.py, hierarchy.py, __init__.py) |
| **STR-3**  | ‚úÖ     | README: —Ä–∞–∑–¥–µ–ª derive (–∫–æ–Ω—Ü–µ–ø—Ç—ã, –ø—Ä–∏–º–µ—Ä—ã, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å) |
| **STR-4**  | ‚úÖ     | –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç/—Å–±–æ—Ä–∫—É |
| **CLI-1**  | ‚úÖ     | –°–∞–±–∫–æ–º–∞–Ω–¥–∞ `derive` –¥–æ–±–∞–≤–ª–µ–Ω–∞ |
| **CLI-2**  | ‚úÖ     | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: --password/--password-file/--password-env, --salt HEX (–∏–ª–∏ –∞–≤—Ç–æ–≥–µ–Ω), --iterations, --length, --algorithm=pbkdf2 |
| **CLI-3**  | ‚úÖ     | –í—ã–≤–æ–¥ –≤ stdout: `KEY_HEX  SALT_HEX` |
| **CLI-4**  | ‚úÖ     | `--output FILE` –ø–∏—à–µ—Ç —Å—ã—Ä–æ–π –∫–ª—é—á –≤ —Ñ–∞–π–ª |
| **CLI-5**  | ‚úÖ     | –ß—Ç–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ env –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–æ |
| **KDF-1**  | ‚úÖ     | PBKDF2-HMAC-SHA256 —Å –Ω—É–ª—è (RFC 2898), HMAC –∏–∑ Sprint 5 |
| **KDF-2**  | ‚úÖ     | –§–æ—Ä–º—É–ª–∞ DK = T1‚ÄñT2..., Ti = F(P,S,c,i), F=‚äïUj —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ |
| **KDF-3**  | ‚úÖ     | –ü–∞—Ä–æ–ª—å/—Å–æ–ª—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã, —Å–æ–ª—å –º–∏–Ω–∏–º—É–º 16 –±–∞–π—Ç |
| **KDF-4**  | ‚úÖ     | dklen –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π, –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç—Ä–æ–≥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã |
| **KDF-5**  | ‚úÖ     | derive_key(master_key, context, length): HMAC(master_key, context‚Äñcounter), –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ |
| **IO-1**   | ‚úÖ     | –ü–∞—Ä–æ–ª—å –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞/—Ñ–∞–π–ª–∞/env |
| **IO-2**   | ‚úÖ     | –°–æ–ª—å hex –∏–ª–∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è 16 –±–∞–π—Ç —á–µ—Ä–µ–∑ CSPRNG |
| **IO-3**   | ‚úÖ     | –ü—Ä–∏ `--output` –ø–∏—à–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–ª—é—á (raw), —Å–æ–ª—å –Ω–µ –ø–∏—à–µ—Ç—Å—è |
| **IO-4**   | ‚úÖ     | –ü–∞—Ä–æ–ª—å –æ—á–∏—â–∞–µ—Ç—Å—è best-effort –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
| **TEST-1** | ‚úÖ     | –í–µ–∫—Ç–æ—Ä—ã (SHA-256) –Ω–∞ –æ—Å–Ω–æ–≤–µ RFC 6070 –≤ `tests/test_pbkdf2.py` |
| **TEST-2** | ‚úÖ     | –ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö |
| **TEST-3** | ‚úÖ     | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–Ω—ã—Ö –¥–ª–∏–Ω—ã –≤—ã–≤–æ–¥–∞ (1‚Äì40 –±–∞–π—Ç) |
| **TEST-4** | ‚úÖ     | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–∂–∏–¥–∞–µ–º—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å OpenSSL pbkdf2) |
| **TEST-5** | ‚úÖ     | derive_key –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω, —Ä–∞–∑–Ω—ã–π context ‚Üí —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ |
| **TEST-6** | ‚úÖ     | Context separation –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ (encryption vs authentication) |
| **TEST-7** | ‚úÖ     | –†–∞–Ω–¥–æ–º–Ω–æ—Å—Ç—å —Å–æ–ª–∏: 100 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –±–µ–∑ –∫–æ–ª–ª–∏–∑–∏–π |
| **TEST-8** | ‚úÖ     | 10‚ÄØ000 –∏—Ç–µ—Ä–∞—Ü–∏–π ‚Üí ~15.28 s|

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ Sprint 7

- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω PBKDF2-HMAC-SHA256 —Å –Ω—É–ª—è; –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ dklen, –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–æ 1e6+.
- –î–æ–±–∞–≤–ª–µ–Ω derive_key(master_key, context) –Ω–∞ HMAC –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–ª—é—á–µ–π.
- CLI: –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `derive` (–ø–∞—Ä–æ–ª—å –∏–∑ —Å—Ç—Ä–æ–∫–∏/—Ñ–∞–π–ª–∞/env, —Å–æ–ª—å hex/–∞–≤—Ç–æ 16 –±–∞–π—Ç, iterations, length, –≤—ã–≤–æ–¥ raw –≤ —Ñ–∞–π–ª + hex –≤ stdout).
- README –æ–±–Ω–æ–≤–ª—ë–Ω: –∫–æ–Ω—Ü–µ–ø—Ç—ã (stretching, salt, iterations, context separation), –ø—Ä–∏–º–µ—Ä—ã, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
- –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤–µ–∫—Ç–æ—Ä—ã, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å, –¥–ª–∏–Ω—ã, —Å–æ–ª—å, –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏ CLI.

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `pycryptocore/kdf/pbkdf2.py` ‚Äî PBKDF2-HMAC-SHA256, generate_salt, derive_key_from_password.
- `pycryptocore/kdf/hierarchy.py` ‚Äî derive_key(master_key, context, length).
- `pycryptocore/kdf/__init__.py` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç API.
- `pycryptocore/cli.py` ‚Äî subcommand `derive`.
- `tests/test_pbkdf2.py`, `tests/test_cli_derive.py` ‚Äî –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã.
- `README.md` ‚Äî —Ä–∞–∑–¥–µ–ª derive –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å KDF.

### –ü—Ä–∏–º–µ—Ä—ã CLI
```bash
# –° –∑–∞–¥–∞–Ω–Ω–æ–π —Å–æ–ª—å—é –∏ –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏
python -m pycryptocore.cli derive --password "password" --salt 73616c74 --iterations 1 --length 32

# –ê–≤—Ç–æ-—Å–æ–ª—å 16 –±–∞–π—Ç, 500k –∏—Ç–µ—Ä–∞—Ü–∏–π
python -m pycryptocore.cli derive --password "Another" --iterations 500000 --length 16

# –ü–∞—Ä–æ–ª—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã
python -m pycryptocore.cli derive --password-env APP_PWD --length 32

# –ó–∞–ø–∏—Å—å –∫–ª—é—á–∞ –≤ —Ñ–∞–π–ª (raw)
python -m pycryptocore.cli derive --password "app_key" --salt 00112233445566778899aabbccddeeff --length 32 --output app_key.bin
```

### –†–∏—Å–∫–∏/–∑–∞–º–µ—á–∞–Ω–∏—è
- –ü–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å PBKDF2 –ø—Ä–∏ >1e6 –∏—Ç–µ—Ä–∞—Ü–∏–π –∑–∞–≤–∏—Å–∏—Ç –æ—Ç CPU; –∑–∞–º–µ—Ä—è—Ç—å –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–º.
- –°–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 16 –±–∞–π—Ç; –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å.
- –ü–∞—Ä–æ–ª—å –æ—á–∏—â–∞–µ—Ç—Å—è best-effort (–∑–∞–Ω—É–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞), –Ω–æ –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

